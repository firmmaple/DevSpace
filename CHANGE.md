# 功能变更记录

## 2024-06-27: 添加用户活动跟踪系统 (Activity Tracking System)

### 新增功能

1. **活动历史记录**
   - 自动跟踪用户活动，包括：
     - 创建文章
     - 编辑文章
     - 浏览文章
     - 点赞文章
     - 收藏文章
     - 发表评论

2. **活动数据统计**
   - 提供每篇文章的访问量、点赞量等统计数据
   - 支持按时间段查询（日/周/月）

3. **个人活动历史**
   - 用户可在个人资料页查看自己的活动历史
   - 支持按活动类型筛选

### 技术实现

1. **数据结构**
   - 新增 `user_activity` 表存储用户活动数据
   - 新增 `article_daily_stats` 表存储文章每日统计数据

2. **后端实现**
   - 活动事件系统基于Spring事件机制实现
   - 所有用户交互均通过事件异步记录，不影响主业务流程
   - 引入批量统计任务，每天汇总生成文章统计数据

3. **前端实现**
   - 个人主页添加"活动历史"标签页
   - 文章详情页添加统计图表展示功能

### 数据填充

- 创建了初始化脚本，自动生成历史活动数据和统计数据，便于功能展示和测试

## 2024-07-09: Profile 页面增强 (活动 & 统计)

### 功能增强

1.  **活动历史记录 (Activity History Tab)**
    *   在用户个人资料页面 (`profile.html`) 添加 "活动历史" 标签页。
    *   使用 `profile-stats.js` 脚本从 `/api/activities/user/{userId}` 获取并展示用户活动列表。
    *   实现活动类型筛选下拉菜单和分页功能。

2.  **文章统计 (Article Statistics Section)**
    *   在个人资料页用新的 "文章统计" 卡片替换了原有的空白 "Activity" 卡片。
    *   默认显示用户所有文章的**聚合**统计数据 (总浏览、点赞、收藏)。聚合数据通过前端获取每篇文章的统计信息 (`/api/stats/article/{articleId}`) 并汇总计算得出。
    *   添加下拉菜单，允许用户选择查看**特定**文章的统计数据。
    *   使用 Chart.js 展示所选范围（全部或单篇）文章的浏览量、点赞量、收藏量随时间变化的图表。
    *   提供时间段选择按钮 (7天/30天/90天) 刷新统计数据和图表。

### 问题修复

1.  **API 端点修复**: 修正了 `profile-stats.js` 中获取用户活动和文章统计时使用的 API 端点，确保与后端控制器 (`UserActivityRestController`, `ArticleStatsRestController`) 匹配。
2.  **评论内容显示**: 修复了活动历史记录中评论内容显示为原始 JSON 字符串的问题，现在能正确解析并显示评论文本。
3.  **首页热门作者**: 修复了 `index.js` 中处理 `/api/users/popular` API 响应的错误。
